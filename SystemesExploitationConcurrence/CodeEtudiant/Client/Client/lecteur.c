#include "lecteur.h"

#define BUFFER_SIZE 1024

void readVoie(BUF* buffer, int tube) {
    //The process is blocked until the semaphore is unlocked
    //read from the buffer and writing in the tube
    write(tube, buffer->tampon[buffer->n], 1);
}

BUF* CreateVoie(key_t cle) {
    //shmget
    int CLTshmid = shmget(cle,2*sizeof(BUF),0666|IPC_CREAT);
    //shmat
    BUF *MemTamponPtr = (BUF *)shmat(CLTshmid,NULL,0);
    return MemTamponPtr;
}

void Lecteur_Start(key_t key, int tube) {
    BUF* buffer = CreateVoie((void*)key);
    while(1) readVoie(buffer, tube);
}