
#include "./Client/CL_include.h"
#include "./Client/redacteur.h"
#include "./Client/lecteur.h"
#include "CL.h"


void litbuf1();
void litbuf2();

int voie;			/*variable globale (numero du canal a lire)*/

int CreationMessagerie(){
	key_t key;
	int  msqid;
	if (( key = ftok(CleServeur,'M')) < 0 )
	return CLEerr;
	msqid = msgget(key,0666|IPC_CREAT);
	return msqid;
}

int Connect(dmsgbuf message){
	pid_t ClientPID = getpid();    
	printf("Client PID: %d\n", ClientPID);
	pid_t MsqID = CreationMessagerie();
	message.type=CONNECT;
	sprintf(message.txt,  "%d", ClientPID);
	msgsnd(MsqID,&message,L_MSG,IPC_NOWAIT);
	int erreur=msgrcv(MsqID,&message,L_MSG,message.type,0);
	return erreur;
}

int main(int argc, char *argv[])
{
	  /* ... */

	  if(argc < 2) {
		printf("!!!! Usage : Client  <+/-nombre de donnees>\n");
		return 1;
	  }


	signal(SIGUSR1, litbuf1);
	signal(SIGUSR2, litbuf2);

	int nb_iteration = atoi(argv[1]);

	printf("\n* * * * * * * * * * * * * * * * * * * * * * * * *\n");
	printf("Projet CLIENT - SERVEUR\tTemps RÃ©el E2i - Novembre\n");
	printf("* * * * * * * * * * * * * * * * * * * * * * * * *\n");
	printf("\nLancement du client pendant %d secondes\n", nb_iteration);
	
	
        /* TO BE CONTINUED */
	dmsgbuf message;
	Connect(message);

return 0;
}	   	   

	   	   	   
/*/////////////////////////////////////////////////////////////////////////*/
	   
void litbuf1() /* semaphore 0 */
{
	voie=0;
	signal(SIGUSR1,litbuf1);
}


/*/////////////////////////////////////////////////////////////////////////*/

void litbuf2()
{
	voie=1;	
	signal(SIGUSR2,litbuf2);
}
